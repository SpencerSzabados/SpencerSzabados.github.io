<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Perlin Worms | Spencer Szabados </title> <meta name="author" content="Spencer Szabados"> <meta name="description" content="The personal webpage of Spencer Szabados. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?b05f9a0b7405d7c8c89c7465593dea81"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?dadeb9c5d1fd12bc8d37475657446863"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?53a094b51ed1d1e025731eb00d240058" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?4d3046c2f9e13528b0ca4b9c73eb03ec" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8D%81&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://spencerszabados.github.io/blog/2022/perlin-worms/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?46af317e693b09921dcb92261d123fbc" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?8b4007b6a6e0a73df09a3389d6f49210"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Spencer</span> Szabados </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Perlin Worms</h1> <p class="post-meta"> July 20, 2022 </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/graphics"> <i class="fa-solid fa-hashtag fa-sm"></i> graphics</a>   <a href="/blog/tag/procedural-generation"> <i class="fa-solid fa-hashtag fa-sm"></i> procedural_generation</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>The impetus for this post came from my personal struggles to find a solid reference and working code demonstration of what are called “noise worms”, as I had stumbled upon an illustration and brief description of them when researching some early (2000’s era) procedural generation techniques. The best write up I came across is that given on <a href="http://libnoise.sourceforge.net/examples/worms/" rel="external nofollow noopener" target="_blank">libnoise</a> from which this post is inspired.</p> <hr> <h1 id="overview">Overview</h1> <p><em>Noise Worms</em> are a procedurally generated illustrations of worm like objects, which are composed of joined line segments (polylines) orientated by a noise function, Perlin Noise <a class="citation" href="#Perlin:1989">(Perlin &amp; Hoffert, 1989)</a> in our case. An example of a collection of noise worms is given below:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worms_dist_bias_1-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worms_dist_bias_1-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worms_dist_bias_1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worms_dist_bias_1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h1 id="implementing-perlin-noise">Implementing Perlin noise</h1> <p>Out of historical interest, we will be using a JavaScript port of Perlin’s <em>Improved noise</em> Java reference implementation, given in <a class="citation" href="#Perlin:2002">(Perlin, 2002)</a>, which I implemented using the <a href="https://p5js.org/" rel="external nofollow noopener" target="_blank">p5.js</a> graphics library.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Port of Ken Perlin's 2002 Java Reference Implementation of Improved Noise</span>
<span class="c1">//to JavaScript</span>

<span class="c1">//BUILD PERMUTATION (AND HASH) ARRAY </span>
<span class="kd">let</span> <span class="nx">p</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">//LENGTH OF 512</span>
<span class="kd">let</span> <span class="nx">permutation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">151</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">137</span><span class="p">,</span><span class="mi">91</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">201</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">194</span><span class="p">,</span><span class="mi">233</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">69</span><span class="p">,</span><span class="mi">142</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">240</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span>
  <span class="mi">190</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span><span class="mi">148</span><span class="p">,</span><span class="mi">247</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">234</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">197</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">252</span><span class="p">,</span><span class="mi">219</span><span class="p">,</span><span class="mi">203</span><span class="p">,</span><span class="mi">117</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">57</span><span class="p">,</span><span class="mi">177</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span>
  <span class="mi">88</span><span class="p">,</span><span class="mi">237</span><span class="p">,</span><span class="mi">149</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">174</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">136</span><span class="p">,</span><span class="mi">171</span><span class="p">,</span><span class="mi">168</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">165</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">134</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">166</span><span class="p">,</span>
  <span class="mi">77</span><span class="p">,</span><span class="mi">146</span><span class="p">,</span><span class="mi">158</span><span class="p">,</span><span class="mi">231</span><span class="p">,</span><span class="mi">83</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">229</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">133</span><span class="p">,</span><span class="mi">230</span><span class="p">,</span><span class="mi">220</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">92</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">245</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">244</span><span class="p">,</span>
  <span class="mi">102</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">161</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span><span class="mi">209</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">132</span><span class="p">,</span><span class="mi">187</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">169</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">196</span><span class="p">,</span>
  <span class="mi">135</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">188</span><span class="p">,</span><span class="mi">159</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span><span class="mi">164</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">173</span><span class="p">,</span><span class="mi">186</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">226</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span>
  <span class="mi">5</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">147</span><span class="p">,</span><span class="mi">118</span><span class="p">,</span><span class="mi">126</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">82</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">207</span><span class="p">,</span><span class="mi">206</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">227</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">189</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span>
  <span class="mi">223</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">213</span><span class="p">,</span><span class="mi">119</span><span class="p">,</span><span class="mi">248</span><span class="p">,</span><span class="mi">152</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">154</span><span class="p">,</span><span class="mi">163</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span><span class="mi">221</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">155</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span><span class="mi">172</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span>
  <span class="mi">129</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">253</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">113</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">232</span><span class="p">,</span><span class="mi">178</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">218</span><span class="p">,</span><span class="mi">246</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">228</span><span class="p">,</span>
  <span class="mi">251</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">242</span><span class="p">,</span><span class="mi">193</span><span class="p">,</span><span class="mi">238</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">191</span><span class="p">,</span><span class="mi">179</span><span class="p">,</span><span class="mi">162</span><span class="p">,</span><span class="mi">241</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">235</span><span class="p">,</span><span class="mi">249</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">239</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span>
  <span class="mi">49</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">214</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span><span class="mi">181</span><span class="p">,</span><span class="mi">199</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">157</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">176</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">121</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">254</span><span class="p">,</span>
  <span class="mi">138</span><span class="p">,</span><span class="mi">236</span><span class="p">,</span><span class="mi">205</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">222</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">67</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">243</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">195</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">180</span><span class="p">];</span>
<span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
  <span class="nx">p</span><span class="p">[</span><span class="mi">256</span><span class="o">+</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">permutation</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> 
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">pNoise</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">X</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">// FIND UNIT SQUARE THAT</span>
  <span class="kd">let</span> <span class="nx">Y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">// CONTAINS POINT.</span>
  <span class="kd">let</span> <span class="nx">Z</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">z</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">;</span>
      <span class="nx">x</span> <span class="o">-=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>      <span class="c1">// FIND RELATIVE X,Y,Z</span>
      <span class="nx">y</span> <span class="o">-=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>      <span class="c1">// OF POINT IN CUBE.</span>
      <span class="nx">z</span> <span class="o">-=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">u</span> <span class="o">=</span> <span class="nf">fade</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>             <span class="c1">// COMPUTE FADE CURVES</span>
  <span class="kd">let</span> <span class="nx">v</span> <span class="o">=</span> <span class="nf">fade</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>             <span class="c1">// FOR EACH OF X,Y.</span>
  <span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="nf">fade</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">A</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="nx">X</span>  <span class="p">]</span><span class="o">+</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">AA</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="nx">A</span><span class="p">]</span><span class="o">+</span><span class="nx">Z</span><span class="p">,</span> <span class="nx">AB</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="nx">A</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">Z</span><span class="p">,</span>  <span class="c1">// HASH COORDINATES OF</span>
      <span class="nx">B</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="nx">X</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">BA</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="nx">B</span><span class="p">]</span><span class="o">+</span><span class="nx">Z</span><span class="p">,</span> <span class="nx">BB</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="nx">B</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">Z</span><span class="p">;</span>  <span class="c1">// THE 4 SQUARE CORNERS,</span>

  <span class="k">return</span> <span class="nf">linerp</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nf">linerp</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nf">linerp</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nf">grad</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">AA</span>  <span class="p">],</span> <span class="nx">x</span>  <span class="p">,</span> <span class="nx">y</span>  <span class="p">,</span> <span class="nx">z</span>   <span class="p">),</span>  <span class="c1">// AND ADD</span>
                                       <span class="nf">grad</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">BA</span>  <span class="p">],</span> <span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span>  <span class="p">,</span> <span class="nx">z</span>   <span class="p">)),</span> <span class="c1">// BLENDED</span>
                             <span class="nf">linerp</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nf">grad</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">AB</span>  <span class="p">],</span> <span class="nx">x</span>  <span class="p">,</span> <span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">z</span>   <span class="p">),</span>  <span class="c1">// RESULTS</span>
                                       <span class="nf">grad</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">BB</span>  <span class="p">],</span> <span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">z</span>   <span class="p">))),</span><span class="c1">// FROM  8</span>
                   <span class="nf">linerp</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nf">linerp</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nf">grad</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">AA</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nx">x</span>  <span class="p">,</span> <span class="nx">y</span>  <span class="p">,</span> <span class="nx">z</span><span class="o">-</span><span class="mi">1</span> <span class="p">),</span>  <span class="c1">// CORNERS</span>
                                       <span class="nf">grad</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">BA</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span>  <span class="p">,</span> <span class="nx">z</span><span class="o">-</span><span class="mi">1</span> <span class="p">)),</span> <span class="c1">// OF CUBE</span>
                             <span class="nf">linerp</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span> <span class="nf">grad</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">AB</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nx">x</span>  <span class="p">,</span> <span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">z</span><span class="o">-</span><span class="mi">1</span> <span class="p">),</span>
                                       <span class="nf">grad</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">BB</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">z</span><span class="o">-</span><span class="mi">1</span> <span class="p">))));</span>
<span class="p">}</span>
   
<span class="kd">function</span> <span class="nf">fade</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">t</span> <span class="o">*</span> <span class="nx">t</span> <span class="o">*</span> <span class="nx">t</span> <span class="o">*</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nf">linerp</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">t</span> <span class="o">*</span> <span class="p">(</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">a</span><span class="p">);</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nf">grad</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">hash</span> <span class="o">&amp;</span> <span class="mi">15</span><span class="p">;</span>    <span class="c1">// CONVERT LOW 4 BITS OF HASH CODE INTO 12 GRADIENT DIRECTIONS.</span>
  <span class="kd">let</span> <span class="nx">u</span> <span class="o">=</span> <span class="nx">h</span><span class="o">&lt;</span><span class="mi">8</span> <span class="p">?</span> <span class="nx">x</span> <span class="p">:</span> <span class="nx">y</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">h</span><span class="o">&lt;</span><span class="mi">4</span> <span class="p">?</span> <span class="nx">y</span> <span class="p">:</span> <span class="nx">h</span><span class="o">==</span><span class="mi">12</span><span class="o">||</span><span class="nx">h</span><span class="o">==</span><span class="mi">14</span> <span class="p">?</span> <span class="nx">x</span> <span class="p">:</span> <span class="nx">z</span><span class="p">;</span>
  <span class="k">return </span><span class="p">((</span><span class="nx">h</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">u</span> <span class="p">:</span> <span class="o">-</span><span class="nx">u</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">h</span><span class="o">&amp;</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">v</span> <span class="p">:</span> <span class="o">-</span><span class="nx">v</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>Taking a 2D slice of the 3D noise volume on a uniformly spaced grid (often also called a Lattice) of sample points gives the following image:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="c1">//draw grid of noise values</span>
  <span class="nf">createCanvas</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">);</span>
  <span class="nf">background</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
  
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">width</span><span class="o">*</span><span class="nx">height</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nf">noStroke</span><span class="p">();</span>
    <span class="nf">fill</span><span class="p">((</span><span class="nf">pNoise</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="nx">width</span><span class="o">+</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">~~</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="nx">height</span><span class="p">)</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">128</span><span class="p">);</span>
    <span class="nf">square</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="nx">width</span><span class="p">,</span> <span class="o">~~</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="nx">height</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_noise_80x80%201-480.webp 480w,/assets/img/posts/perlin-worms/perlin_noise_80x80%201-800.webp 800w,/assets/img/posts/perlin-worms/perlin_noise_80x80%201-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_noise_80x80%201.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>The sharp contrast between cells (pixels) is due to the coarse sampling of grid points. If we were to sample in a more continual sweep across the space, we would get smooth boundaries due to the spline interpolation used within the algorithm. The following image illustrates this for a finer grid.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="c1">//draw grid of noise values</span>
  <span class="nf">createCanvas</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">);</span>
  <span class="nf">background</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
  
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">*</span><span class="nx">width</span><span class="o">*</span><span class="nx">height</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">){</span>
      <span class="nf">noStroke</span><span class="p">();</span>
      <span class="nf">fill</span><span class="p">((</span><span class="nf">pNoise</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="nx">width</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="nx">j</span><span class="p">,</span> <span class="o">~~</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="nx">height</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">128</span><span class="p">);</span>
      <span class="nf">square</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="nx">width</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="nx">j</span><span class="p">,</span> <span class="o">~~</span><span class="p">(</span><span class="nx">i</span><span class="o">/</span><span class="nx">height</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_noise_80x80_super-480.webp 480w,/assets/img/posts/perlin-worms/perlin_noise_80x80_super-800.webp 800w,/assets/img/posts/perlin-worms/perlin_noise_80x80_super-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_noise_80x80_super.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h1 id="constructing-the-worms">Constructing the worms</h1> <p>Given our noise domain (defined above) we can construct the worms. To do this, a <em>lookup line segment</em> is placed within a noise domain (e.g., Perlin Noise is used here as it gives a coherent space) and used it to perform directional lookups at sample points along its length. These sample points correspond to segments on the worm and are used to orient each relative to the previous segment along the worm.</p> <p>The following code defines a simple worm class, a sampling segment, and a loop for rendering the worm based on the noise samples drawn from the segment.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Worm</span><span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">seg</span> <span class="o">=</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">seg</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nf">grow</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">seg</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nf">display</span><span class="p">(){</span>
    <span class="kd">let</span> <span class="nx">girth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
    <span class="c1">//draw the worm segment by segment    </span>
    <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="o">-</span><span class="mi">2</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="o">/</span><span class="mi">2</span><span class="p">){</span>
        <span class="nf">strokeWeight</span><span class="p">(</span><span class="nx">girth</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">));</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nf">strokeWeight</span><span class="p">(</span><span class="nx">girth</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="o">-</span><span class="nx">i</span><span class="p">)</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nf">stroke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span>
      <span class="nf">line</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="k">this</span><span class="p">.</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="k">this</span><span class="p">.</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="k">this</span><span class="p">.</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]);</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="nf">createCanvas</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
  <span class="nf">background</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
  <span class="nf">angleMode</span><span class="p">(</span><span class="nx">RADIANS</span><span class="p">);</span>
  
  <span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Worm</span><span class="p">(</span><span class="nf">random</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">350</span><span class="p">),</span><span class="nf">random</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">350</span><span class="p">),</span><span class="dl">'</span><span class="s1">#967445</span><span class="dl">'</span><span class="p">);</span> 
  <span class="kd">let</span> <span class="nx">lsegXmax</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">240</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">lsegX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">lsegXmax</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="nx">maxLen</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">lsegY</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">);</span>
  
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">30</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="kd">let</span> <span class="nx">segLen</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">pN</span> <span class="o">=</span> <span class="nf">pNoise</span><span class="p">(</span><span class="nx">lsegX</span><span class="o">*</span><span class="nx">i</span><span class="p">,</span><span class="nx">lsegY</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">segLen</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
    <span class="kd">let</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">segLen</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&gt;</span> <span class="nx">width</span><span class="p">){</span>  <span class="c1">//boundary detection</span>
      <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dx</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&gt;</span> <span class="nx">height</span><span class="p">){</span>
      <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dy</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">w</span><span class="p">.</span><span class="nf">grow</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span><span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span><span class="p">);</span>  <span class="c1">//add segment to worm</span>
  <span class="p">}</span>
  <span class="nx">w</span><span class="p">.</span><span class="nf">display</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div> <p>Here are two examples for the kinds of worms that can be generated using this simple script and method for two different randomly placed segments within the same noise volume. The worm that turns smoothly, that is does not jitter, results from a finely divided lookup segment in the noise domain, and vise versa for the worm with lots of jitter.</p> <p>As can be seen, generating procedural objects like these is incredibly simple and the method achieves a good amount of diversity in generation.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worm%202-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worm%202-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worm%202-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worm%202.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worm_smooth%201-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worm_smooth%201-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worm_smooth%201-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worm_smooth%201.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>This method, which is quite bear bones, can be further modified to generate worms with directional bias to give increasingly varied results.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="nf">createCanvas</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
  <span class="nf">angleMode</span><span class="p">(</span><span class="nx">RADIANS</span><span class="p">);</span>
  
  <span class="kd">let</span> <span class="nx">nWorms</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">maxLen</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
  
  <span class="c1">//create array of worms</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">n</span><span class="o">&lt;</span><span class="nx">nWorms</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">){</span>
    <span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Worm</span><span class="p">(</span><span class="nf">random</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">350</span><span class="p">),</span><span class="nf">random</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">350</span><span class="p">),</span><span class="dl">'</span><span class="s1">#967445</span><span class="dl">'</span><span class="p">);</span> 
    <span class="kd">let</span> <span class="nx">lsegXstart</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">240</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">lsegXend</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="nx">lsegXstart</span><span class="p">,</span><span class="nx">lsegXstart</span><span class="o">+</span><span class="mi">10</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">lsegX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">lsegXend</span><span class="o">-</span><span class="nx">lsegXstart</span><span class="p">)</span><span class="o">/</span><span class="nx">maxLen</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">lsegY</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">lsegZ</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">255</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">xBias</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">yBias</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">maxLen</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="kd">let</span> <span class="nx">segLen</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">pN</span> <span class="o">=</span> <span class="nf">pNoise</span><span class="p">(</span><span class="nx">lsegX</span><span class="o">*</span><span class="nx">i</span><span class="p">,</span><span class="nx">lsegY</span><span class="p">,</span><span class="nx">lsegZ</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">segLen</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="nx">xBias</span><span class="o">*</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
      <span class="kd">let</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">segLen</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="nx">yBias</span><span class="o">*</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&gt;</span> <span class="nx">width</span><span class="p">){</span>  <span class="c1">//boundary detection</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dx</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&gt;</span> <span class="nx">height</span><span class="p">){</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dy</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">w</span><span class="p">.</span><span class="nf">grow</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span><span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span><span class="p">);</span>  <span class="c1">//add segment to worm</span>
    <span class="p">}</span>
    <span class="nx">w</span><span class="p">.</span><span class="nf">display</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worms_2%201-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worms_2%201-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worms_2%201-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worms_2%201.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worms_3-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worms_3-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worms_3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worms_3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>By implementing different distance bias expressions for \(dx\) and \(dy\), respectively the displacement in \(x\) and \(y\), a wide range of different appearances can be achieved.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worms_dist_bias_5-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worms_dist_bias_5-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worms_dist_bias_5-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worms_dist_bias_5.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worms_dist_bias_1-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worms_dist_bias_1-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worms_dist_bias_1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worms_dist_bias_1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worms_dist_bias_7-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worms_dist_bias_7-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worms_dist_bias_7-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worms_dist_bias_7.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h2 id="animating-the-worms">Animating the worms</h2> <p>Due to Perlin noise being a source of coherent noise, meaning its output changes smoothly and proportionately with small and large changes in input, worms can be smoothly animated by gradually translating their lookup segments within the noise domain and accordingly updating segments along the worms.</p> <p>The following code animates a singular worm using the simple method proposed above.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">nWorms</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>    <span class="c1">// number of worms</span>
<span class="kd">let</span> <span class="nx">maxLen</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>    <span class="c1">// number of segments on a worm </span>
<span class="kd">let</span> <span class="nx">worms</span> <span class="o">=</span> <span class="p">[];</span>     <span class="c1">// array of worms</span>
<span class="kd">let</span> <span class="nx">segMaxLen</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// lookup segment max length</span>
<span class="kd">let</span> <span class="nx">segs</span>  <span class="o">=</span> <span class="p">[];</span>     <span class="c1">// array of lookup segments [..., x, y, z, div, xBias, yBias, ...]</span>
<span class="kd">let</span> <span class="nx">dirVec</span> <span class="o">=</span> <span class="p">[];</span>    <span class="c1">// array of direction vectors for lookup segment translation</span>


<span class="kd">function</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="nf">createCanvas</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>  <span class="c1">//set up window</span>
  <span class="nf">angleMode</span><span class="p">(</span><span class="nx">RADIANS</span><span class="p">);</span>
  
  <span class="c1">//create array of worms</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">n</span><span class="o">&lt;</span><span class="nx">nWorms</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Worm</span><span class="p">(</span><span class="nf">random</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">350</span><span class="p">),</span><span class="nf">random</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">350</span><span class="p">),</span><span class="dl">'</span><span class="s1">#967445</span><span class="dl">'</span><span class="p">);</span> 
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span>  <span class="p">]</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">240</span><span class="p">);</span>
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">255</span><span class="p">);</span>
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">255</span><span class="p">);</span>
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nf">random</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">5</span><span class="p">],</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="nx">segMaxLen</span><span class="p">)</span><span class="o">-</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">5</span><span class="p">])</span><span class="o">/</span><span class="nx">maxLen</span><span class="p">;</span>
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span>
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nf">random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">maxLen</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="kd">let</span> <span class="nx">segLen</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">//random(5,10);</span>
      <span class="kd">let</span> <span class="nx">pN</span> <span class="o">=</span> <span class="nf">pNoise</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="nx">i</span><span class="p">,</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">]);</span>
      <span class="kd">let</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">segLen</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
      <span class="kd">let</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">segLen</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&gt;</span> <span class="nx">width</span><span class="p">){</span>  <span class="c1">//boundary detection</span>
        <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dx</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&gt;</span> <span class="nx">height</span><span class="p">){</span>
        <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dy</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nf">grow</span><span class="p">(</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">x</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">y</span><span class="o">+</span><span class="nx">dy</span><span class="p">);</span>  <span class="c1">//add segment to worm</span>
    <span class="p">}</span>
    <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nf">display</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">draw</span><span class="p">(){</span>
  <span class="nf">frameRate</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
  <span class="nf">clear</span><span class="p">();</span>
  
  <span class="k">for</span><span class="p">(</span><span class="nx">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">n</span><span class="o">&lt;</span><span class="nx">nWorms</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">){</span>
    <span class="kd">let</span> <span class="nx">dirX</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">dirY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">dirZ</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>
    
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span>  <span class="p">]</span> <span class="o">+=</span> <span class="nx">dirX</span><span class="p">;</span>
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dirY</span><span class="p">;</span>
    <span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dirZ</span><span class="p">;</span>
    
    <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">len</span><span class="p">){</span>
      <span class="kd">let</span> <span class="nx">segLen</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">pN</span> <span class="o">=</span> <span class="nf">pNoise</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="nx">i</span><span class="p">,</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">]);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
        <span class="kd">let</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nf">cos</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
        <span class="kd">let</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&gt;</span> <span class="nx">width</span><span class="p">){</span>  <span class="c1">//boundary detection</span>
          <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dx</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&gt;</span> <span class="nx">height</span><span class="p">){</span>
          <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dy</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span>  <span class="p">]</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span>
        <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span> 
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="c1">//segLen = dist(worms[n].seg[2*i-2],worms[n].seg[2*i-1],worms[n].seg[2*i],worms[n].seg[2*i+1]);</span>
        <span class="kd">let</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">segLen</span><span class="o">*</span><span class="nf">cos</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
        <span class="kd">let</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">segLen</span><span class="o">*</span><span class="nf">sin</span><span class="p">(</span><span class="nx">segs</span><span class="p">[</span><span class="nx">n</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="nx">PI</span><span class="o">*</span><span class="p">(</span><span class="nx">pN</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="nx">dx</span> <span class="o">&gt;</span> <span class="nx">width</span><span class="p">){</span>  <span class="c1">//boundary detection</span>
          <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dx</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">dy</span> <span class="o">&gt;</span> <span class="nx">height</span><span class="p">){</span>
          <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="nx">dy</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span>  <span class="p">]</span> <span class="o">=</span> <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="nx">dx</span><span class="p">;</span>
        <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">seg</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">dy</span><span class="p">;</span> 
      <span class="p">}</span>
      <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">worms</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nf">display</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/perlin-worms/perlin_worms_1-480.webp 480w,/assets/img/posts/perlin-worms/perlin_worms_1-800.webp 800w,/assets/img/posts/perlin-worms/perlin_worms_1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/perlin-worms/perlin_worms_1.gif" class="img-fluid rounded z-depth-1" width="100%" height="auto" style="margin:auto; display:block; max-width: 400px; " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><em>Disgusting</em>.</p> <h2 id="animating-other-objects-using-noise">Animating other objects using noise</h2> <p>This method of pseudo-random animation is not limited to line segments but can be applied to any set of vertices by associating each to a moving point in the noise domain.</p> </div> </article> <h2>References</h2> <div class="publications"> <h2 class="bibliography">2002</h2> <ol class="bibliography"><li> <div class="row"> <div class="col-sm-2 abbr"> <abbr class="badge"></abbr> </div> <div id="Perlin:2002" class="col-sm-8"> <div class="title">Improving noise</div> <div class="author"> Ken Perlin </div> <div class="periodical"> 2002 </div> <div class="periodical"> </div> <div class="links"> <a href="https://mrl.cs.nyu.edu/%C2%A0perlin/paper445.pdf" class="btn btn-sm z-depth-0" role="button" rel="external nofollow noopener" target="_blank">URL</a> </div> </div> </div> </li></ol> <h2 class="bibliography">1989</h2> <ol class="bibliography"><li> <div class="row"> <div class="col-sm-2 abbr"> <abbr class="badge"></abbr> </div> <div id="Perlin:1989" class="col-sm-8"> <div class="title">Hypertexture</div> <div class="author"> K. Perlin , and E. M. Hoffert </div> <div class="periodical"> <em>In Proceedings of the 16th Annual Conference on Computer Graphics and Interactive Techniques</em> , 1989 </div> <div class="periodical"> </div> <div class="links"> <a class="abstract btn btn-sm z-depth-0" role="button">Abs</a> <a href="https://doi.org/10.1145/74333.74359" class="btn btn-sm z-depth-0" role="button" rel="external nofollow noopener" target="_blank">URL</a> </div> <div class="abstract hidden"> <p>We model phenomena intermediate between shape and texture by using space-filling applicative functions to modulate density. The model is essentially an extension of procedural solid texture synthesis, but evaluated throughout a volumetric region instead of only at surfaces.We have been able to obtain visually realistic representations of such shape+texture (hypertexture) phenomena as hair, fur, fire, glass, fluid flow and erosion effects. We show how this is done, first by describing a set of base level functions to provide basic texture and control capability, then by combining these to synthesize various phenomena.Hypertexture exists within an intermediate region between object and not-object. We introduce a notion of generalized boolean shape operators to combine shapes having such a region.Rendering is accomplished by ray marching from the eye point through the volume to accumulate opacity along each ray. We have implemented our hypertexture rendering algorithms on a traditional serial computer, a distributed network of computers and a coarse-grain MIMD computer. Extensions to the rendering technique incorporating refraction and reflection effects are discussed.</p> </div> </div> </div> </li></ol> </div> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/bayer-dithering/">Bayer Dithering</a> </li> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Spencer Szabados. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: October 14, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?b977fe0c21b2118ed853308b1b923969"></script> <script defer src="/assets/js/bootstrap-toc.min.js?e5d98150f26024952efec2f7f9d30e5c"></script> <script src="/assets/js/no_defer.js?3ff7cc03fd475bd4728929ccd4ecf3f4"></script> <script defer src="/assets/js/common.js?6deead716675b00c409ff8575afa1cdb"></script> <script defer src="/assets/js/copy_code.js?d359581efc54b08366f9ef8219e6e511" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?25eff8ff4144a010e4ad7b31403102cf"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>